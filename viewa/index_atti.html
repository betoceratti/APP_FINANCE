<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
 
     <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1.0, user-scalable=no"> 
     <meta name="referrer" content="strict-origin-when-cross-origin">

    <!-- Bootstrap CSS -->
       <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">  
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
           <!-- JavaScript -->
    <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>

      <!-- CSS -->
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
<!-- Default theme -->
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css"/>
<!-- Semantic UI theme -->
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/semantic.min.css"/>
<!-- Bootstrap theme -->
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.min.css"/>


    <title>Hello, world!</title>
  </head>
  <style>

    

    input[type='text'],input[type='number'],textarea {font-size:16px;} body{ -webkit-text-size-adjust:none;}

    .active{
   border-bottom: 1px solid purple;
    width: 30%;
   
    
      }



    .hide{
        display: none;

     }

    .bi{
      font-size: 20px;
    }

    .nav{height:60px}

    section{min-height:100vh}  
    

  </style>
  <body>

       <!-- menu reposive -->
    <nav class="navbar navbar-light bg-light fixed-bottom">
        <div class="container">
       
          <div class=" navbar m-auto" id="navbarNav">
            <ul class="nav ">
              <li class="nav-item ">
                <a class="nav-link active cash text-warning" aria-current="page" href="#sectionCash"> <i class="bi bi-coin"></i></a>
              </li>
              <li class="nav-item ">
                <a class="nav-link azteca  text-success" href="#sectionBancoAzteca"> <i class="bi bi-cash-coin"></i></a>
              </li>
              <li class="nav-item ">
                <a class="nav-link bbva  text-primary" href="#sectionBancomer"> <i class="bi bi-cash-coin"></i></a>
              </li>
               <li class="nav-item ">
                <a class="nav-link grafica  text-info" href="#sectionChart"><i class="bi bi-bar-chart-line"></i></a>
              </li>
               <li class="nav-item ">
                <a class="nav-link grafica debito text-danger" href="#sectionDebito"><i class="bi bi-ui-radios"></i></a>
              </li>

                <li class="nav-item ">
                <a class="nav-link grafica efectivo text-danger" href="#sectionEfectivo"><i class="bi bi-arrows-move"></i></a>
              </li>
             
            </ul>
          </div>
        </div>
      </nav>

      <!-- tittle -->
      <div class="text-center p-2 shadow rounded w-75 mx-auto bg-black mt-1">
          <h1 class="h2 text-info">Hola Roberto</h1>
      </div>

        <!--SECTION EFECTIVO CONTAINER 1-->
      <div class="container p-2" id="sectionCash">
        <div class="text-center p-2">
            <h2 class="display-2 fw-bold text-black-50"><?= saldoCash?></h2>
               <p class="text-muted h5">Ultimos Gastos Efectivo <i class="bi bi-coin"></i></p>
        </div>

        <?= listas.forEach(gasto =>{?>

          <?if(gasto[13] ==1){?>
           <div class="row m-1">

                  <div class="col col-md-3 bg-warning p-1 br-1 rounded">
            <div class="text-black"><?= gasto[0]?></div>
            </div>
             </div>
          
          
          <?}else{?>
          
          
           <div class="row m-1">

                  <div class="col col-md-3 bg-white p-1 br-1 rounded">
            <div class="text-white"><?= gasto[0]?></div>
            </div>
             </div>
          
          <?} ?>
        
          
             
           
          
       
           <div class="row border p-2">
            
            <div class="col col-sm-3">
            <div class="fw-bold fs-6"><?= gasto[1]?></div>
            </div>
            <div class="col col-sm-7">
            <div class="fs-6 text-secondary"><?= gasto[2]?></div>
            </div>
            <div class="col col-sm-2">
            <div class="fw-bold fs-6 text-danger"><?= gasto[3]?></div>
            </div>
         
       
            
        </div>
        
        
        
        <? }) ?>

       

      </div>


      <!--SECTION BANCOS CONTAINER 2-->
      <div class="container p-2 hide" id="sectionBancoAzteca">
        <div class="text-center p-2">
            <h2 class="display-2 fw-bold text-success"><?= saldoAzteca?></h2>
             <p class="text-success h5">Ultimos Gastos Banco Azteca <i class="bi bi-cash-coin"></i></p>
        </div>
              
        <?= listas.forEach(gasto =>{?>
        
          
               <?if( gasto[12] == 1){?>
                <div class="row m-1">
                 <div class="col col-md-3 bg-success p-1 br-1 rounded">
            <div class="text-white"><?= gasto[8]?></div>
            </div>
              </div>

             <?}else{?>
               <div class="row m-1">
               <div class="col col-md-3 bg-white p-1 br-1 rounded">
            <div class="text-white"><?= gasto[8]?></div>
            </div>
              </div>
             
             
             <?} ?>
             
         
        
           
       
           <div class="row border p-2">
            
            <div class="col col-sm-4">
            <div class="fw-bold fs-6"><?= gasto[9]?></div>
            </div>
            <div class="col col-sm-3">
            <div class="fs-6 text-secondary"><?= gasto[10]?></div>
            </div>
            <div class="col col-sm-3">
            <div class="fw-bold fs-6 text-danger"><?= gasto[11]?></div>
            </div>      
       
            
        </div>       
        
        
        <? }) ?>



      </div>

      <!--SECTION BANCOS CONTAINER 3-->
      <div class="container p-2 hide" id="sectionBancomer">
        <div class="text-center p-2">
            <h2 class="display-2 fw-bold text-primary"><?= saldoBbva?></h2>
             <p class="text-primary h5">Ultimos Gastos BBVA <i class="bi bi-cash-coin"></i></p>
        </div>


                   
        <?= listas.forEach(gasto =>{?>
        
           <div class="row m-1">
         
            <div class="col col-md-3 bg-primary p-1 br-1 rounded">
            <div class="text-white"><?= gasto[4]?></div>
            </div>
            
             </div>
       
           <div class="row border p-2">
            
            <div class="col col-sm-4">
            <div class="fw-bold fs-6"><?= gasto[5]?></div>
            </div>
            <div class="col col-sm-3">
            <div class="fs-6 text-secondary"><?= gasto[6]?></div>
            </div>
            <div class="col col-sm-3">
            <div class="fw-bold fs-6 text-danger"><?= gasto[7]?></div>
            </div>
         
       
            
        </div>
        
        
        
        <? }) ?>
    

      </div>

       <!--SECTION GRAFICAS CONTAINER 4-->
        <div class="container p-2 hide" id="sectionChart">
            <div class="row text-center p-2">
     <h1 class="text-muted">Categorias Cash</h1>
     </div>

    <div class="row justify-content-center ">

  <div class="chart-container mx-auto" style="position: relative; height:40vh; width:90vw">
    <canvas id="myChart"></canvas>
    <hr>
    <canvas id="myChart2"></canvas>
    <hr>
      <canvas id="myChart3"></canvas>
  </div>

    </div>


        </div>


      <!--SECTION FORMULARIO DEBITO CONTAINER 5-->
        <section class="container p-2 hide" id="sectionDebito">


           <form id="form" class="row shadow p-2 bg-ligth">
        <div class="col-12" >

      <div class="mb-3">
        <label for="date" class="form-label">Fecha</label>
        <input type="date" class="form-control" id="date">
      </div>

    <div class="mb-3">
    <label for="monto" class="form-label">Importe</label>
    <input class="form-control form-control-sm" type="number" placeholder="$0.00" aria-label=".form-control-sm example" id="monto">

      </div>


      </div> <!--colum 1-->

       <div class="col-12">

        <div class="mb-3">
      <label for="myInput1" class="form-label">Concepto</label>
        <input class="form-control" list="datalistOptions" id="myInput1" placeholder="Watmart, Uber Eats...">
        <datalist id="datalistOptions">
       
        </datalist>
    </div>

          <div class="mb-1">
      <label for="myInput2" class="form-label">Banco</label>
        <input class="form-control" list="datalistOptiones" id="myInput2" placeholder="Banorte,Bancomer...">
        <datalist id="datalistOptiones">         
          <option value="BANCOMER">
          <option value="BANCO AZTECA">
          <option value="MERCADO PAGO">
          <option value="BANAMAEX">
              
        </datalist>
    </div>

    <div class="mb-1">
       <label for="nota" class="form-label">Nota Debito</label>
       <input class="form-control" type="text" placeholder="Captura detalle ....." id="nota">
    </div>


    </div> <!--columa 2-->

  <hr>
    <div class="mb-3">
      <button type="submit" class="btn btn-outline-dark" value="Send" id="btn-send">Send</button>
  <!-- <button type="button" class="btn btn-outline-danger" value="Close" id="btn-close" onclick="cerrar()">Close</button> -->
    </div>



           </form>

        </section>



        <!--SECTION FORMULARIO DEBITO CONTAINER 6-->
        <section class="container p-2 hide" id="sectionEfectivo">

       
           <form id="formulario" class="row shadow p-2 bg-ligth">
        <div class="col-12" >

      <div class="mb-3">
        <label for="fecha" class="form-label">Fecha</label>
        <input type="date" class="form-control" id="fecha">
      </div>

    <div class="mb-3">
    <label for="cantidad" class="form-label">Importe</label>
    <input class="form-control form-control-sm" type="number" placeholder="$0.00" aria-label=".form-control-sm example" id="cantidad" autocomplete="off">

      </div>


      </div> <!--colum 1-->

       <div class="col-12">

        <div class="mb-3">
      <label for="category" class="form-label">Categoria</label>
        <input class="form-control" list="datalistOptionsE" id="category" placeholder="Alimentos,Medicamentos...">
        <datalist id="datalistOptionsE">
            <option value="" disabled selected>Elige la Categoria</option>
            <option value="Alimentos">
            <option value="Medicamentos">
            <option value="Automovil">
            <option value="Propinas">
            <option value="Ahorro">
            <option value="Casa Reparaciones">
          
       
        </datalist>
    </div>

          <div class="mb-1">
      <label for="descripcion" class="form-label">Descripcion</label>
        <input class="form-control" list="datalistOptionesEf" id="descripcion" placeholder="Tortillas,Gasolina...">
        <datalist id="datalistOptionesEf">         
        <option value="Tortilla">Tortilla</option>
      <option value="Pan">Pan</option>
       <option value="Pepsi">Pepsi</option>
        <option value="Propinas Isacc">
         <option value="Agua de Garrafon">
          <option value="Tienda Inditos">
           <option value="Carniceria">
            <option value="Farmacia del Ahorro">
             <option value="Gasolina">
             <option value="Vulcanizadora">
              <option value="Alcancia Mama">
               <option value="Poda Arbol">
                 <option value="Fontaneria">
                  <option value="Pintura-Impermeabilizar">
                   <option value="Pollo Brujo">
                    <option value="Doña Clarita">
              
        </datalist>
    </div>

    <div class="mb-1">
       <label for="note" class="form-label">Nota Efectivo</label>
       <input class="form-control" type="text" placeholder="Captura detalle ....." id="note">
    </div>


    </div> <!--columa 2-->

  <hr>
    <div class="mb-3">
      <button type="button" class="btn btn-outline-dark" value="Send" id="btn-send" onclick="enviarDatos()" >Send</button>
  <!-- <button type="button" class="btn btn-outline-danger" value="Close" id="btn-close" onclick="cerrar()">Close</button> -->
    </div>



           </form>

        </section>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>


  <script>   


    const enlaces = document.querySelectorAll('.nav .nav-item a')
    const cash = document.getElementById('sectionCash')
    const azteca = document.getElementById('sectionBancoAzteca')
    const bbva = document.getElementById('sectionBancomer')
    const chart = document.getElementById('sectionChart')
    const formDebito = document.getElementById('sectionDebito')
    const formEfectivo = document.getElementById('sectionEfectivo')

    enlaces.forEach(enlace =>{

        enlace.addEventListener('click',(e)=>{
            e.preventDefault()

          if(e.target.classList.contains('cash')){
              
              bbva.classList.add('hide')
              azteca.classList.add('hide')
              chart.classList.add('hide')
              formDebito.classList.add('hide')  
              formEfectivo.classList.add('hide')   
              cash.classList.toggle('hide')
              enlaces.forEach(elemento => elemento.classList.remove('active'))
              enlace.classList.toggle('active')
              
          }

          if(e.target.classList.contains('azteca')){

            cash.classList.add('hide')
            bbva.classList.add('hide')
            chart.classList.add('hide')
            formDebito.classList.add('hide')  
            formEfectivo.classList.add('hide')  
            azteca.classList.toggle('hide')
            enlaces.forEach(elemento => elemento.classList.remove('active'))
            enlace.classList.toggle('active')
          
            }

            if(e.target.classList.contains('bbva')){
                cash.classList.add('hide')
                azteca.classList.add('hide')
                chart.classList.add('hide')
                formDebito.classList.add('hide')
                formEfectivo.classList.add('hide')  
                bbva.classList.toggle('hide')
                enlaces.forEach(elemento => elemento.classList.remove('active'))
                enlace.classList.toggle('active')
              
              
            }

              if(e.target.classList.contains('grafica')){
                cash.classList.add('hide')
                azteca.classList.add('hide')
                bbva.classList.add('hide')
                formDebito.classList.add('hide')
                formEfectivo.classList.add('hide')
                chart.classList.toggle('hide')
                enlaces.forEach(elemento => elemento.classList.remove('active'))
                enlace.classList.toggle('active')
              
              
            }

               if(e.target.classList.contains('debito')){
                cash.classList.add('hide')
                azteca.classList.add('hide')
                bbva.classList.add('hide')
                chart.classList.add('hide')
                formEfectivo.classList.add('hide')
                formDebito.classList.toggle('hide')
                enlaces.forEach(elemento => elemento.classList.remove('active'))
                enlace.classList.toggle('active')
              
              
            }

              if(e.target.classList.contains('efectivo')){
                cash.classList.add('hide')
                azteca.classList.add('hide')
                bbva.classList.add('hide')
                chart.classList.add('hide')
                formDebito.classList.add('hide')
                formEfectivo.classList.toggle('hide')
                enlaces.forEach(elemento => elemento.classList.remove('active'))
                enlace.classList.toggle('active')
              
              
            }


        })
});


//FUNCIONES PARA LA GRAFICA
 window.addEventListener('load',cargarGrafica)

function cargarGrafica(){

  google.script.run.withSuccessHandler(renderGraficas).getCategorias();

};

function renderGraficas(data){

const ctx = document.getElementById('myChart')
const ctx2 = document.getElementById('myChart2')
const ctx3 = document.getElementById('myChart3')

let conceptos = []
let valores = []


data.forEach(mes =>{
   conceptos.push(mes[0])
   valores.push(mes[1])
  


})

const myChart = new Chart(ctx,{

type: "pie",

data:{ 
labels: conceptos,
datasets: [{

label: "Categorias",
data: valores,
backgroundColor: [
  
    ' rgba(127, 193, 29, 0.82)',
      ' rgba(0, 0, 255, 0.821)',
    'rgb(255, 205, 86)',
    'rgba(221, 23, 69, 0.82)',
    'rgba(23, 221, 119, 0.82)'

],
borderColor:[
    'rgba(127, 193, 29, 0.82',
    'rgb(54, 162, 235)',
    'rgb(255, 205, 86)',
    'rgba(221, 23, 69, 0.82)',
    'rgba(23, 221, 119, 0.82)'

], options: {
    responsive: true,
    legend: {
      position: 'bottom'
    },
    plugins: {
      datalabels: {
        color: '#fff',
        anchor: 'end',
        align: 'start',
        offset: -10,
        borderWidth: 2,
        borderColor: '#fff',
        borderRadius: 25,
        backgroundColor: (context) => {
          return context.dataset.backgroundColor;
        },
        font: {
          weight: 'bold',
          size: '10'
        },
        formatter: (value) => {
          return value + ' %';
        }
      }
    }
  },

borderWidth: 1,

title:"A T T I"
}]
},


});   


};


//CODIGO PARA EL FORMULARIO DEBITO BANCOS
   window.addEventListener('load',cargarDatos);

  const formulario = document.getElementById('form')
  const fecha = document.getElementById('date')
  const monto = document.getElementById('monto')
  const descripcion = document.getElementById('myInput1')
  const banco = document.getElementById('myInput2')
  const nota = document.getElementById('nota')


    function cargarDatos(){

      google.script.run.withSuccessHandler(renderLista).getData();



    };


    function renderLista(data){

      // alert(data)
      const inputLista = document.getElementById('datalistOptions')

      data.forEach(dato =>{
         const option = document.createElement('option')

         option.value = dato[0]
         option.text = dato[1] 

          inputLista.appendChild(option)
      })      
    

    };


      formulario.addEventListener('submit',(e)=>{
      e.preventDefault();

      if(fecha.value !=="" && monto.value !=="" && descripcion.value !=="" && banco.value !== ""){

        const data = {
          fecha : fecha.value,
          monto : monto.value,
          descripcion : descripcion.value,
          banco : banco.value,
          nota : nota.value

        }

        google.script.run.withSuccessHandler(retardo).saveBancos(data);
         alertify.success("El registro fue agregado con exito!")
       
      }else{

         alertify.error('Completa los campos!');
      }  



    });


    function retardo(){

      setTimeout(() => {
        clear()
      },4000);

    };


    function preguntar(){
      const respuesta = confirm("Deseas seguir agregando mas registros ?")

      respuesta ? clear() : cerrar();

    };




    function clear(){
      monto.value = ""
      descripcion.value =""
      banco.value = ""
      nota.value =""

      fecha.focus();


    };



   


    //CODIGO PARA EL FORMLARIO DE EFECTIVO


     function limpiar(e){
        var fecha = document.getElementById("fecha");
        var cantidad = document.getElementById("cantidad");
        var category = document.getElementById("category");
        var descripcion = document.getElementById("descripcion");       
        var note = document.getElementById('note');
         var mensaje = document.getElementById("mensaje");
        fecha.value = "";
        monto.value = "";
        category.value = "";
        descripcion.value = "";
        nota.value ="";
        fecha.focus;
   
    };
    
    
    function enviarDatos(){
      var fecha = document.getElementById("fecha").value;
      var cantidad = document.getElementById("cantidad").value;
      var category = document.getElementById("category").value;
      var descripcion = document.getElementById("descripcion").value;
      var note = document.getElementById('note').value;
      //Guardamos los valores en un arreglo diccionario 
      var data={fecha:fecha,monto:cantidad,category:category,descripcion:descripcion,nota:note};
      
      if(fecha != "" &&  cantidad  >0 && category != "" && descripcion !=""){
    
      google.script.run.withSuccessHandler(retardar).saveGastos(data);
      
      alertify.success('Gasto contabilizado con exito!');
      
      
      }else{
        alertify.error('Completa los campos!');
      }
      
    };
    
     function retardar(){

      setTimeout(() => {
        limpiar()
      },4000);

    };




  </script>
 
  </body>
</html>
